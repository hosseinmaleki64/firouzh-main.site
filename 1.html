<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="صفحه پرداخت فینگرفود فیروزه - تکمیل سفارش با روش‌های پرداخت امن">
    <meta name="keywords" content="فینگرفود, پرداخت, فیروزه, سفارش آنلاین">
    <meta name="author" content="FingerFood Firoozeh">
    <title>صفحه پرداخت - FingerFood Firoozeh</title>
    <link href="https://cdn.jsdelivr.net/npm/@fontsource/shabnam@5.0.1/index.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
    <style>
        :root {
            --header-h: 80px;
            --primary-color: #26A69A;
            --secondary-color: #1A7A6F;
            --background-color: #f8f9fa;
            --neutral-color: #dadee6;
            --text-dark: #4B5563;
            --text-light: #edebeb;
            --gradient-start: linear-gradient(135deg, var(--secondary-color), #2E2A3F);
            --header-bg: #064d3b;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --gray-box: #f1f3f5;
            --border-color: #e9ecef;
            --rental-color: #e67e22;
            --free-color: #27ae60;
            --error-color: #e63946;
            --success-color: #2a9d8f;
            --warning-color: #f39c12;
        }

        [data-theme="dark"] {
            --header-bg: #1a3c34;
            --text-light: #e0e0e0;
            --background-color: #1a1a1a;
            --text-dark: #cccccc;
            --gray-box: #2d3748;
            --border-color: #4a5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body { 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
        }
        body {
            font-family: 'Shabnam', Arial, sans-serif;
            background: var(--background-color);
            color: var(--text-dark);
            line-height: 1.8;
            overflow-x: hidden;
            padding-top: 90px;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: rgba(6, 77, 59, 0.9);
            backdrop-filter: blur(10px);
            color: var(--text-light);
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1200px;
            z-index: 1001;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        .menu-icon {
            font-size: 1.4rem;
            cursor: pointer;
            order: 1;
        }

        .menu-icon:hover i {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }

        .logo-search {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            order: 2;
            flex-direction: column;
        }

        .logo {
            font-family: 'Shabnam', 'IRANSans', 'Vazir', Arial, sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-light);
            text-decoration: none;
            text-transform: uppercase;
        }

        .logo img {
            height: 28px;
            width: auto;
        }

        .promo-text-mobile {
            font-size: 0.85rem;
            color: #FFD700;
            display: none;
            text-align: center;
            margin-top: 5px;
        }

        .search-box {
            position: relative;
            width: 280px;
            max-width: 100%;
            display: flex;
            align-items: center;
        }

        .search-box input {
            flex: 1;
            padding: 8px 40px 8px 40px;
            border: none;
            border-radius: 20px 0 0 20px;
            font-family: 'Shabnam', 'IRANSans', 'Vazir', Arial, sans-serif;
            font-size: 0.95rem;
            outline: none;
            direction: rtl;
            background: var(--text-light);
        }

        .search-icon, .clear-icon {
            background: var(--text-light);
            padding: 8px 12px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-icon {
            border-radius: 0 20px 20px 0;
        }

        .clear-icon {
            position: absolute;
            left: 0;
            display: none;
        }

        .clear-icon.active {
            display: flex;
        }

        .cart-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            order: 3;
            position: relative;
        }

        .promo-text {
            font-size: 0.85rem;
            color: #FFD700;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .cart-link, .profile-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-light);
            position: relative;
            transition: color 0.3s;
        }

        .cart-link:hover, .profile-link:hover {
            color: var(--primary-color);
        }

        .cart-link:hover i, .profile-link:hover i {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e63946;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7rem;
        }

        .profile-icon {
            font-size: 1.1rem;
            cursor: pointer;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--neutral-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .user-menu {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            color: black;
            border: 1px solid var(--neutral-color);
            width: 200px;
            padding: 10px;
            z-index: 1002;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .user-menu.active {
            display: block;
        }

        .user-menu .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .user-menu .user-info .avatar {
            font-size: 2rem;
        }

        .user-menu a, .user-menu button {
            display: block;
            padding: 8px;
            text-decoration: none;
            color: var(--text-dark);
            cursor: pointer;
        }

        .user-menu a:hover, .user-menu button:hover {
            background: var(--neutral-color);
        }

        .side-menu {
            position: fixed;
            inset-block: 0;
            inset-inline-start: -100%;
            width: 320px;
            background: var(--secondary-color);
            color: var(--text-light);
            border-right: 3px solid var(--primary-color);
            padding: 24px;
            overflow: auto;
            z-index: 1003;
            box-shadow: 12px 0 30px rgba(0, 0, 0, 0.2);
            transition: inset-inline-start 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .side-menu.active {
            inset-inline-start: 0;
        }
        .close-btn {
            font-size: 2rem;
            color: var(--text-light);
            cursor: pointer;
            line-height: 1;
            margin-bottom: 20px;
            transition: color 0.2s ease;
        }
        .close-btn:hover { 
            color: var(--primary-color); 
        }
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .overlay.active { 
            opacity: 1; 
            visibility: visible; 
        }

        .search-container {
            position: fixed;
            inset-block-start: calc(var(--header-h) + 20px);
            inset-inline: 0;
            background: var(--background-color);
            padding: 24px;
            box-shadow: 0 4px 20px rgba(14, 13, 13, 0.358);
            z-index: 1002;
            display: none;
            direction: rtl;
        }

        .search-container.active {
            display: block;
        }

        .search-container input {
            width: calc(100% - 24px);
            padding: 14px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-family: 'Shabnam', 'IRANSans', 'Vazir', Arial, sans-serif;
            font-size: 1.1rem;
            transition: var(--transition);
            direction: rtl;
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(38, 166, 154, 0.2);
        }

        .search-results {
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            background: var(--neutral-color);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .search-results .result-item {
            padding: 12px;
            border-bottom: 1px solid rgba(38, 166, 154, 0.2);
            color: var(--text-dark);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-results .result-item:hover {
            background: rgba(38, 166, 154, 0.1);
            color: var(--primary-color);
        }

        .search-results .no-results {
            color: #D32F2F;
            font-size: 1rem;
            text-align: center;
            padding: 12px;
        }

        main { 
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .wizard-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            max-width: 1000px;
            margin: 0 auto;
        }

        .wizard-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }

        .wizard-header h1 {
            font-size: 28px;
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .wizard-header p {
            color: #666;
            font-size: 16px;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .progress-bar::before {
            content: "";
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--border-color);
            z-index: 1;
        }

        .progress-fill {
            position: absolute;
            top: 20px;
            left: 0;
            height: 4px;
            background: var(--primary-color);
            z-index: 2;
            transition: width 0.3s ease;
        }

        .progress-percentage {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: var(--border-color);
            color: #666;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: var(--success-color);
            color: white;
        }

        .step-text {
            font-size: 14px;
            font-weight: 500;
            color: #666;
            text-align: center;
        }

        .step.active .step-text {
            color: var(--primary-color);
            font-weight: 600;
        }

        .step.completed .step-text {
            color: var(--success-color);
        }

        .wizard-content {
            min-height: 400px;
        }

        .step-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-content.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }

        /* Step Styles */
        .products-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .products-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
        }

        .products-header h2 {
            font-size: 22px;
            color: var(--primary-color);
            font-weight: 700;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin-left: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .product-details {
            flex: 1;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px;
            color: var(--text-dark);
        }

        .product-meta {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }

        .product-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--primary-color);
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .quantity-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }

        .quantity-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            border-color: #ccc;
        }

        .quantity {
            width: 45px;
            text-align: center;
            border: 2px solid var(--neutral-color);
            border-radius: 8px;
            padding: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .product-price {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
            min-width: 100px;
            text-align: center;
        }

        .remove-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #e63946;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .remove-btn:hover {
            background: rgba(230, 57, 70, 0.1);
            transform: scale(1.1);
        }

        .order-summary-box {
            background: var(--gray-box);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 500;
            color: var(--text-dark);
        }

        .summary-value {
            font-weight: 600;
        }

        .grand-total {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid var(--primary-color);
        }

        .discount-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .discount-input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .discount-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Shabnam', Arial, sans-serif;
            direction: rtl;
            text-align: right;
        }

        .discount-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(38, 166, 154, 0.2);
        }

        .discount-btn {
            padding: 12px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            white-space: nowrap;
        }

        .discount-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .payment-methods {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .payment-options {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .payment-option {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 600;
        }

        .payment-option:hover {
            border-color: var(--primary-color);
        }

        .payment-option.selected {
            border-color: var(--primary-color);
            background: rgba(38, 166, 154, 0.1);
        }

        .payment-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f0f0f0;
        }

        .payment-description {
            margin-top: 20px;
            padding: 15px;
            background: var(--gray-box);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .trust-section {
            margin-top: 20px;
            padding: 15px;
            background: var(--gray-box);
            border-radius: 8px;
            text-align: center;
        }

        .trust-section p {
            margin-bottom: 10px;
        }

        .trust-logos {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .trust-logos img {
            height: 40px;
            width: auto;
        }

        .packaging-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .packaging-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .packaging-options {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .packaging-option {
            flex: 1;
            text-align: center;
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .packaging-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
        }

        .packaging-option.selected {
            border-color: var(--primary-color);
            background: rgba(38, 166, 154, 0.1);
        }

        .packaging-image {
            width: 100%;
            height: 120px;
            object-fit: contain;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: opacity 0.3s ease;
        }

        .packaging-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .packaging-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
            min-height: 60px;
        }

        .packaging-label {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .packaging-label.rental {
            background: var(--rental-color);
        }

        .packaging-label.free {
            background: var(--free-color);
        }

        .packaging-note {
            margin-top: 20px;
            padding: 15px;
            background: var(--gray-box);
            border-radius: 8px;
            font-size: 13px;
            text-align: center;
            border-right: 4px solid var(--rental-color);
        }

        /* Address Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 16px;
        }

        .required::after {
            content: " *";
            color: var(--error-color);
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Shabnam', Arial, sans-serif;
            font-size: 16px;
            direction: rtl;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(38, 166, 154, 0.2);
        }

        .form-control.error {
            border-color: var(--error-color);
        }

        .form-control.valid {
            border-color: var(--success-color);
        }

        .placeholder-text {
            font-size: 14px;
            color: #999;
            margin-top: 5px;
        }

        .address-note {
            background: #fff8e1;
            border-right: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-col {
            flex: 1;
        }

        .delivery-time-info {
            background: #e3f2fd;
            border-right: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .time-error {
            color: var(--error-color);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .time-error.active {
            display: block;
        }

        /* Confirmation Styles */
        .payment-confirmation {
            text-align: center;
            padding: 30px;
        }

        .payment-icon {
            font-size: 60px;
            color: var(--success-color);
            margin-bottom: 20px;
        }

        .payment-amount {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .payment-details {
            background: var(--gray-box);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            text-align: right;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
        }

        .detail-value {
            font-weight: 600;
        }

        .invoice-note {
            background: #e3f2fd;
            border-right: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }

        .products-list {
            margin-top: 20px;
            padding: 15px;
            background: var(--gray-box);
            border-radius: 8px;
        }

        .product-summary {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .product-summary:last-child {
            border-bottom: none;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .action-buttons {
                position: sticky;
                bottom: 0;
                background: var(--background-color);
                padding: 10px 20px;
                z-index: 10;
                border-top: none;
            }
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-family: 'Shabnam', Arial, sans-serif;
            text-align: center;
        }

        .btn-prev {
            background: var(--gray-box);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
        }

        .btn-prev:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .btn-next {
            background: var(--primary-color);
            color: white;
        }

        .btn-next:hover:not(:disabled) {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-next:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-confirm {
            background: var(--success-color);
            color: white;
        }

        .btn-confirm:hover {
            background: #218870;
            transform: translateY(-2px);
        }

        footer {
            background: var(--gradient-start);
            color: var(--text-light);
            text-align: center;
            padding: 40px 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        footer::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><circle cx="20" cy="20" r="5" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="3" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: 100px 100px;
        }

        footer h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 15px;
            color: var(--primary-color);
            position: relative;
            z-index: 1;
        }

        footer p {
            max-width: 600px;
            margin: 0 auto 20px;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        footer .links {
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        footer a {
            color: var(--text-light);
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            padding: 8px 15px;
            border-radius: 8px;
        }

        footer a:hover { 
            color: var(--primary-color); 
            background: rgba(255, 255, 255, 0.1);
        }

        footer .contact-info {
            font-size: 1rem;
            margin: 20px 0;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        #clock { 
            color: var(--text-light); 
            margin-top: 15px; 
            font-weight: 500;
            font-size: 0.95rem;
            position: relative;
            z-index: 1;
        }

        footer .copyright {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            position: relative;
            z-index: 1;
        }

        .social-bar {
            background: transparent;
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 15px 0;
            margin-top: 25px;
            flex-wrap: nowrap;
            position: relative;
            z-index: 1;
        }

        .social-box {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 12px;
        }

        .social-box img {
            width: 24px;
            height: 24px;
            margin-bottom: 5px;
            object-fit: contain;
        }

        .social-box:hover {
            background: var(--primary-color);
            color: var(--text-light);
            transform: scale(1.05);
        }

        .logo-box {
            width: 70px;
            height: 70px;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .logo-box img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-box:hover {
            transform: scale(1.05);
        }

        /* Auth Modal Styles */
        .auth-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1004;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .auth-modal-content {
            background: var(--background-color);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 420px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            direction: rtl;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .auth-modal.active .auth-modal-content {
            transform: scale(1);
        }
        .auth-modal-close {
            position: absolute;
            top: 16px;
            left: 16px;
            font-size: 1.8rem;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .auth-modal-close:hover {
            color: var(--secondary-color);
            background: rgba(38, 166, 154, 0.1);
        }
        .auth-modal-header {
            text-align: center;
            margin-bottom: 24px;
        }
        .auth-modal-header .site-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.4rem;
            font-weight: 700;
        }
        .auth-modal-header .site-logo img {
            height: 28px;
        }
        .auth-modal-header h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin: 8px 0 4px;
        }
        .auth-modal-header .greeting {
            font-size: 1.2rem;
            margin: 0;
            color: var(--text-dark);
        }
        .auth-modal-header p {
            color: var(--text-dark);
            font-size: 1rem;
            margin: 4px 0 16px;
        }
        .wizard-step {
            display: none;
        }
        .wizard-step.active {
            display: block;
        }
        .auth-form label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: var(--text-dark);
            font-weight: 500;
        }
        .auth-form input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--neutral-color);
            border-radius: 12px;
            font-family: 'Shabnam', 'IRANSans', 'Vazir', Arial, sans-serif;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
            direction: ltr;
            text-align: center;
            margin-bottom: 16px;
        }
        .auth-form input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(38, 166, 154, 0.2);
        }
        .auth-form button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: var(--primary-color);
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .auth-form button:hover {
            background: var(--secondary-color);
            color: var(--text-light);
            transform: translateY(-2px);
        }
        .auth-form button:active {
            transform: translateY(0);
        }
        .auth-form .error {
            color: #D32F2F;
            font-size: 0.95rem;
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        .auth-form .success {
            color: #388E3C;
            font-size: 0.95rem;
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        .auth-form .timer {
            color: var(--text-dark);
            font-size: 0.9rem;
            text-align: center;
            margin-top: 8px;
            display: none;
        }
        .auth-form .terms {
            font-size: 0.85rem;
            color: var(--text-dark);
            text-align: center;
            margin-top: 8px;
        }
        .wizard-buttons {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }
        .wizard-buttons button {
            flex: 1;
        }
        .wizard-buttons .prev {
            background: var(--neutral-color);
            color: var(--text-dark);
        }
        .wizard-buttons .prev:hover {
            background: #ccc;
        }
        
        /* Character and Username Selection */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 24px 0;
        }
        .character-card {
            background: var(--neutral-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-dark);
        }
        .character-card:hover {
            background: var(--primary-color);
            color: var(--text-light);
            transform: translateY(-3px);
        }
        .character-card.selected {
            background: var(--primary-color);
            color: var(--text-light);
            box-shadow: 0 4px 15px rgba(38, 166, 154, 0.3);
        }

        /* Logout Modal */
        .logout-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1005;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .logout-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .logout-modal-content {
            background: var(--background-color);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            direction: rtl;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            text-align: center;
        }
        .logout-modal.active .logout-modal-content {
            transform: scale(1);
        }
        .logout-modal-content h2 {
            color: var(--primary-color);
            font-size: 1.6rem;
            margin: 0 0 12px;
        }
        .logout-modal-content p {
            color: var(--text-dark);
            font-size: 0.9rem;
            margin: 0 0 24px;
        }
        .logout-buttons {
            display: flex;
            gap: 16px;
        }
        .logout-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .logout-buttons .confirm {
            background: var(--primary-color);
            color: var(--text-light);
            border: none;
        }
        .logout-buttons .confirm:hover {
            background: var(--secondary-color);
        }
        .logout-buttons .cancel {
            background: var(--neutral-color);
            color: var(--text-dark);
            border: none;
        }
        .logout-buttons .cancel:hover {
            background: #ccc;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .username-strength {
            height: 5px;
            background: #ddd;
            margin-top: -10px;
            margin-bottom: 10px;
            border-radius: 3px;
        }
        .username-strength.weak { background: red; }
        .username-strength.medium { background: orange; }
        .username-strength.strong { background: green; }
        .input-group {
            position: relative;
        }
        .toggle-visibility {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
        }
        #resendCodeBtn {
            display: none;
            width: 100%;
            margin-top: 10px;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            .cart-panel {
                position: static;
                margin-top: 2rem;
                order: -1;
            }
            .product-section {
                order: 1;
            }
            .categories {
                justify-content: flex-start;
            }
            .slider-track {
                width: calc(200% + 20px); /* Show 2 items on smaller screens */
            }
            .packaging-options {
                flex-direction: column;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .payment-options {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .product-main-image {
                width: 300px;
                height: 180px;
            }
            .product-title {
                font-size: 2rem;
            }
            .product-desc {
                font-size: 1rem;
            }
            .size-btn {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
            .ingredient span {
                font-size: 0.9rem;
            }
            .add-to-cart {
                font-size: 1rem;
                padding: 0.7rem 1.2rem;
            }
            .rec-item img, .other-product-item img {
                height: 100px;
            }
            .rec-item p, .other-product-item p {
                font-size: 0.9rem;
            }
            .rec-item span, .other-product-item span {
                font-size: 0.95rem;
            }
            .rec-item button, .other-product-item button {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
            }
            .navbar {
                width: 95%;
                padding: 10px 15px;
                border-radius: 15px;
            }
            
            .logo-search {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box {
                width: 100%;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .promo-text {
                display: none;
            }
            
            .promo-text-mobile {
                display: block;
            }
            
            main {
                padding: 15px;
            }
            
            .quantity-section {
                flex-direction: column;
                align-items: flex-start;
            }
            .quantity-control {
                width: 100%;
                justify-content: center;
            }
            .product-detail {
                flex-direction: column;
            }
            .product-gallery {
                flex: 0 0 auto;
                width: 100%;
            }
            .product-main-image {
                width: 100%;
            }
            .slider-nav {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .wizard-container {
                padding: 20px 15px;
            }
            
            .product-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .product-image {
                width: 70px;
                height: 70px;
                margin-left: 0;
            }
            
            .product-info {
                display: flex;
                justify-content: space-between;
                width: 100%;
                align-items: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .product-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .navbar {
                width: 95%;
                padding: 10px 15px;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .search-box {
                width: 180px;
            }
            
            .progress-bar {
                flex-direction: column;
                gap: 30px;
            }
            
            .progress-bar::before {
                display: none;
            }
            
            .progress-fill {
                display: none;
            }
        }
        
        @media (max-width: 576px) {
            .product-title {
                font-size: 1.8rem;
            }
            .product-desc {
                font-size: 0.95rem;
            }
            .size-btn {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .ingredient img {
                width: 32px;
                height: 32px;
            }
            .ingredient span {
                font-size: 0.85rem;
            }
            .add-to-cart {
                font-size: 0.95rem;
                padding: 0.6rem 1rem;
            }
            .cart-item span {
                font-size: 0.9rem;
            }
            .quantity-btn {
                width: 25px;
                height: 25px;
                font-size: 0.9rem;
            }
            .promo-input {
                font-size: 0.9rem;
            }
            .total {
                font-size: 1.3rem;
            }
            .confirm-btn {
                font-size: 1rem;
            }
            .social-bar {
                gap: 8px;
            }
            
            .social-box, .logo-box {
                width: 60px;
                height: 60px;
                font-size: 0.7rem;
            }
            
            .social-box img {
                width: 20px;
                height: 20px;
            }
            .product-main-image {
                height: 150px;
            }
            .product-thumbnails {
                flex-wrap: wrap;
            }
            .product-thumbnail {
                width: 60px;
                height: 60px;
            }
            .quantity-input {
                width: 50px;
                font-size: 1rem;
            }
            .other-product-item {
                flex: 0 0 180px;
                min-width: 180px;
            }
            .slider-track {
                width: calc(300% + 20px); /* Show 1 item on very small screens */
            }
            
            /* Mobile-specific optimizations */
            .navbar {
                padding: 8px 12px;
                top: 5px;
                width: 95%;
                border-radius: 12px;
            }
            
            .menu-icon {
                font-size: 1.2rem;
            }
            
            .cart-profile i, .profile-icon {
                font-size: 1rem;
            }
            
            .logo img {
                height: 24px;
            }
            
            .search-box input {
                padding: 6px 30px 6px 30px;
                font-size: 0.85rem;
            }
            
            .search-icon, .clear-icon {
                padding: 6px 10px;
            }
            
            main {
                padding: 12px;
            }
            
            .main-container {
                gap: 20px;
                margin: 1rem auto;
                display: flex;
                flex-direction: column;
            }
            
            .product-detail {
                padding: 1rem;
                border-radius: 10px;
                flex-direction: column;
                margin-top: 20px;
            }
            
            .product-content {
                padding: 0;
            }
            
            .product-title {
                font-size: 1.6rem;
                margin-bottom: 0.3rem;
            }
            
            .product-desc {
                font-size: 0.9rem;
                line-height: 1.5;
            }
            
            .product-desc li {
                padding: 0.3rem 0;
                font-size: 0.85rem;
            }
            
            .product-desc li:before {
                font-size: 1rem;
            }
            
            .size-selector {
                gap: 0.3rem;
                margin-bottom: 0.8rem;
                flex-wrap: wrap;
            }
            
            .size-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                border-radius: 8px;
                flex: 1 1 calc(33% - 0.3rem);
                min-width: 80px;
            }
            
            .quantity-section {
                padding: 0.6rem;
                border-radius: 8px;
                margin-bottom: 0.8rem;
            }
            
            .quantity-section label {
                font-size: 0.9rem;
            }
            
            .quantity-control {
                padding: 0.3rem;
                border-radius: 6px;
            }
            
            .quantity-btn {
                width: 28px;
                height: 28px;
                font-size: 1rem;
            }
            
            .quantity-input {
                width: 40px;
                font-size: 0.9rem;
            }
            
            .build-meal {
                gap: 0.5rem;
                margin: 0.8rem 0;
                flex-wrap: wrap;
            }
            
            .ingredient {
                padding: 0.4rem;
                border-radius: 8px;
                flex: 1 1 calc(50% - 0.5rem);
                min-width: 120px;
            }
            
            .ingredient img {
                width: 28px;
                height: 28px;
            }
            
            .ingredient span {
                font-size: 0.75rem;
            }
            
            .add-to-cart {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
                border-radius: 8px;
                margin-top: 0.8rem;
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
            
            .price-display {
                font-size: 1rem;
            }
            
            .cart-panel {
                padding: 1rem;
                border-radius: 10px;
                order: 2;
            }
            
            .cart-header {
                font-size: 1.2rem;
                margin-bottom: 0.8rem;
            }
            
            .cart-item {
                padding: 0.6rem 0;
                flex-direction: row-reverse;
                justify-content: flex-end;
                gap: 10px;
            }
            
            .cart-item img {
                width: 40px;
                height: 40px;
                margin-left: 10px;
            }
            
            .cart-item span {
                font-size: 0.85rem;
                text-align: right;
                flex: 1;
            }
            
            .quantity-btn {
                width: 24px;
                height: 24px;
                font-size: 0.8rem;
            }
            
            .promo-section {
                margin: 1rem 0;
            }
            
            .promo-input {
                padding: 0.6rem;
                font-size: 0.85rem;
                border-radius: 6px;
            }
            
            .apply-promo-btn {
                padding: 0.5rem 0.8rem;
                font-size: 0.85rem;
                border-radius: 6px;
            }
            
            .discount {
                font-size: 0.85rem;
            }
            
            .total {
                font-size: 1.2rem;
                margin: 0.8rem 0;
            }
            
            .confirm-btn {
                padding: 0.7rem;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            
            .delivery-free {
                font-size: 0.85rem;
            }
            
            .recommendations {
                margin-top: 1.5rem;
                order: 1;
            }
            
            .recommendations h2 {
                font-size: 1.4rem;
                margin-bottom: 1rem;
            }
            
            .rec-grid {
                gap: 15px;
                grid-template-columns: 1fr;
            }
            
            .rec-item {
                padding: 0.8rem;
                border-radius: 10px;
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 15px;
                text-align: right;
            }
            
            .rec-item img {
                height: 80px;
                width: 80px;
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .rec-item .rec-content {
                flex: 1;
                text-align: right;
            }
            
            .rec-item p {
                font-size: 0.8rem;
                margin-bottom: 0.2rem;
            }
            
            .rec-item span {
                font-size: 0.85rem;
                margin-bottom: 0.3rem;
            }
            
            .rec-item .rating {
                font-size: 0.7rem;
                margin-bottom: 0.3rem;
            }
            
            .rec-item button {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
                border-radius: 8px;
                width: auto;
                min-width: 80px;
            }
            
            .other-products {
                margin-top: 2rem;
                padding-top: 1.5rem;
                order: 3;
            }
            
            .other-products h2 {
                font-size: 1.4rem;
                margin-bottom: 1rem;
            }
            
            .slider-container {
                overflow-x: auto;
                scrollbar-width: none;
            }
            
            .slider-container::-webkit-scrollbar {
                display: none;
            }
            
            .slider-track {
                display: flex;
                flex-direction: row;
                width: max-content;
                gap: 15px;
                padding: 10px 0;
            }
            
            .other-product-item {
                padding: 0.8rem;
                border-radius: 10px;
                min-width: 150px;
                flex: 0 0 auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .other-product-item img {
                height: 80px;
                width: 80px;
                margin-bottom: 0.3rem;
            }
            
            .other-product-item p {
                font-size: 0.8rem;
                margin-bottom: 0.2rem;
            }
            
            .other-product-item span {
                font-size: 0.85rem;
            }
            
            .other-product-item .rating {
                font-size: 0.7rem;
                margin-bottom: 0.3rem;
            }
            
            .other-product-item button {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
                border-radius: 4px;
                margin-top: 0.3rem;
                width: 100%;
            }
            
            .slider-nav {
                display: none !important;
            }
            
            footer {
                padding: 20px 15px;
            }
            
            footer h2 {
                font-size: 1.4rem;
                margin: 0 0 10px;
            }
            
            footer p {
                font-size: 0.8rem;
                margin: 0 auto 15px;
            }
            
            footer .links {
                margin: 15px 0;
            }
            
            footer a {
                font-size: 0.75rem;
                margin: 0 8px;
                padding: 6px 10px;
            }
            
            footer .contact-info {
                font-size: 0.8rem;
                margin: 15px 0;
            }
            
            #clock {
                font-size: 0.8rem;
                margin-top: 10px;
            }
            
            footer .copyright {
                margin-top: 15px;
                padding-top: 15px;
                font-size: 0.7rem;
            }
            
            .social-bar {
                gap: 6px;
                padding: 10px 0;
                margin-top: 15px;
            }
            
            .social-box, .logo-box {
                width: 50px;
                height: 50px;
                font-size: 0.55rem;
            }
            
            .social-box img {
                width: 16px;
                height: 16px;
                margin-bottom: 3px;
            }
            
            /* Auth Modal Mobile */
            .auth-modal-content {
                padding: 20px;
                max-width: 95%;
                max-height: 90vh;
            }
            
            .auth-modal-close {
                top: 12px;
                left: 12px;
                font-size: 1.5rem;
                width: 30px;
                height: 30px;
            }
            
            .auth-modal-header .site-logo {
                font-size: 1.2rem;
            }
            
            .auth-modal-header .site-logo img {
                height: 24px;
            }
            
            .auth-modal-header h2 {
                font-size: 1.4rem;
                margin: 6px 0 2px;
            }
            
            .auth-modal-header .greeting {
                font-size: 1rem;
            }
            
            .auth-modal-header p {
                font-size: 0.85rem;
                margin: 2px 0 12px;
            }
            
            .auth-form label {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }
            
            .auth-form input {
                padding: 12px;
                font-size: 0.9rem;
                border-radius: 8px;
                margin-bottom: 12px;
            }
            
            .auth-form button {
                padding: 14px;
                font-size: 1rem;
                border-radius: 8px;
                margin-top: 6px;
            }
            
            .auth-form .error, .auth-form .success {
                font-size: 0.8rem;
                margin-top: 8px;
            }
            
            .auth-form .timer {
                font-size: 0.8rem;
                margin-top: 6px;
            }
            
            .auth-form .terms {
                font-size: 0.75rem;
                margin-top: 6px;
            }
            
            .wizard-buttons {
                gap: 12px;
                margin-top: 12px;
            }
            
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin: 16px 0;
            }
            
            .character-card {
                padding: 15px;
                font-size: 1.5rem;
            }
            
            /* Logout Modal Mobile */
            .logout-modal-content {
                padding: 20px;
                max-width: 95%;
            }
            
            .logout-modal-content h2 {
                font-size: 1.3rem;
                margin: 0 0 8px;
            }
            
            .logout-modal-content p {
                font-size: 0.8rem;
                margin: 0 0 16px;
            }
            
            .logout-buttons {
                gap: 12px;
            }
            
            .logout-buttons button {
                padding: 10px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            
            /* Side Menu Mobile */
            .side-menu {
                width: 280px;
                padding: 20px;
            }
            
            .close-btn {
                font-size: 1.8rem;
                margin-bottom: 15px;
            }
            
            .nav-menu h3 {
                font-size: 1.1rem;
            }
            
            .sub-menu a {
                font-size: 0.9rem;
                padding: 8px 0;
            }
            
            /* Search Container Mobile */
            .search-container {
                padding: 16px;
            }
            
            .search-container input {
                padding: 12px;
                font-size: 0.9rem;
                border-radius: 6px;
            }
            
            .search-results {
                margin-top: 12px;
                max-height: 250px;
                border-radius: 6px;
                padding: 8px;
            }
            
            .search-results .result-item {
                padding: 8px;
                font-size: 0.85rem;
            }
            
            .search-results .no-results {
                font-size: 0.85rem;
                padding: 8px;
            }
            
            .discount-input-group {
                flex-direction: column;
            }
            
            .product-actions {
                flex-wrap: wrap;
            }
            
            .product-price {
                min-width: auto;
            }
        }
    </style>
</head>
<body data-theme="light">
    <header class="navbar">
        <div class="menu-icon" role="button" aria-label="باز کردن منو" aria-controls="sideMenu" aria-expanded="false">
            <i class="fas fa-bars"></i>
        </div>
        <div class="logo-search">
            <a href="index.html" class="logo">
                <img src="https://placehold.co/30x30/26A69A/FFFFFF?text=F" alt="لوگوی فینگرفود فیروزه" loading="lazy loading">
                FIROUZEH
            </a>
            <div class="promo-text-mobile" id="promoTextMobile">⚡بهترین آموزش‌های فینگر فود و سلامت غذایی!</div>
            <div class="search-box">
                <input
                    type="text"
                    placeholder="جستجو برای مواد غذایی، مغازه‌ها، سبزیجات یا گوشت"
                    id="searchInput"
                    aria-label="جستجوی محصولات"
                >
                <div class="clear-icon" id="clearSearch"><i class="fas fa-times"></i></div>
                <div class="search-icon"><i class="fas fa-search"></i></div>
            </div>
        </div>
        <div class="cart-profile">
            <div class="promo-text" id="promoText">⚡بهترین آموزش‌های فینگر فود و سلامت غذایی!</div>
            <a href="/cart" class="cart-link" role="button" aria-label="سبد خرید">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge">3</span>
            </a>
            <div class="profile-link" role="button" aria-label="ورود یا ثبت نام" id="userProfile">
                <i class="fas fa-user profile-icon" id="profileIcon"></i>
            </div>
            <div class="user-menu" id="userMenu">
                <div class="user-info">
                    <span class="avatar" id="userAvatar"></span>
                    <span id="userName"></span>
                </div>
                <a href="/cart">سبد خرید</a>
                <button id="logoutBtn">خروج</button>
            </div>
        </div>
    </header>
    <div class="overlay" id="overlay"></div>
    <nav class="side-menu" id="sideMenu" aria-hidden="true" tabindex="-1">
        <div class="close-btn" aria-label="بستن منو">×</div>
        <ul class="nav-menu">
            <li class="nav-category">
                <h3><i class="fas fa-box-open"></i> دسته‌بندی محصولات</h3>
                <ul class="sub-menu">
                    <li><a href="products.html"><i class="fas fa-list"></i> انواع محصولات</a></li>
                    <li><a href="products.html#subcategories"><i class="fas fa-tags"></i> طبقه‌بندی جانبی</a></li>
                </ul>
            </li>
            <li class="nav-category">
                <h3><i class="fas fa-building"></i> فیروزه</h3>
                <ul class="sub-menu">
                    <li><a href="index.htmlspecial customers.html"><i class="fas fa-crown"></i> مشتریان خاص فیروزه</a></li>
                    <li><a href="index.html#contact-team"><i class="fas fa-headset"></i> تماس با تیم فیروزه</a></li>
                    <li><a href="about.html"><i class="fas fa-info-circle"></i> درباره فیروزه</a></li>
                    <li><a href="index.html#contact"><i class="fas fa-phone"></i> تماس با فیروزه</a></li>
                    <li><a href="index.html#faq"><i class="fas fa-question-circle"></i> سوالات متداول</a></li>
                    <li><a href="index.html#collaboration"><i class="fas fa-handshake"></i> همکاری با فیروزه</a></li>
                    <li><a href="index.html#rules"><i class="fas fa-gavel"></i> قوانین و مقررات</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-content">
            <span class="auth-modal-close" aria-label="بستن فرم" id="closeAuthModal">×</span>
            <div class="auth-modal-header">
                <div class="site-logo">
                    <img src="https://placehold.co/30x30/26A69A/FFFFFF?text=F" alt="لوگوی فینگرفود فیروزه">
                    FIROUZEH
                </div>
                <h2>ورود یا ثبت‌نام</h2>
                <div class="greeting">سلام</div>
                <p>لطفا شماره موبایل خود را وارد کنید</p>
            </div>
            <div class="wizard-step active" id="authStep1">
                <div class="auth-form">
                    <label for="authPhone">شماره موبایل</label>
                    <input type="tel" id="authPhone" placeholder="09123456789" maxlength="11" required>
                    <p class="error" id="authPhoneError">لطفاً شماره موبایل معتبر وارد کنید (11 رقم با شروع 09).</p>
                    <div id="captchaSection">
                        <label id="captchaQuestion"></label>
                        <input type="text" id="captchaAnswer" placeholder="پاسخ را وارد کنید" required>
                        <p class="error" id="captchaError">پاسخ اشتباه است.</p>
                    </div>
                    <p class="terms">ورود شما به معنای پذیرش شرایط و قوانین فیروزه هست</p>
                </div>
                <div class="wizard-buttons">
                    <button id="nextToAuthStep2" disabled>بعدی</button>
                </div>
            </div>
            <div class="wizard-step" id="authStep2">
                <div class="auth-form">
                    <p class="success" id="authSuccess">کد ارسال شد. لطفاً کد دریافتی را وارد کنید.</p>
                    <label for="authCode">کد یک‌بار مصرف</label>
                    <div class="input-group">
                        <input type="password" id="authCode" placeholder="کد را وارد کنید" maxlength="6" required>
                        <i class="fas fa-eye toggle-visibility" id="toggleAuthCode"></i>
                    </div>
                    <p class="error" id="authCodeError">کد نامعتبر است.</p>
                    <p class="timer" id="authTimer">ارسال مجدد کد در: <span id="authCountdown">60</span> ثانیه</p>
                    <button id="resendCodeBtn">ارسال مجدد کد</button>
                </div>
                <div class="wizard-buttons">
                    <button class="prev" id="prevToAuthStep1">قبلی</button>
                    <button id="nextToAuthStep3" disabled>تأیید</button>
                </div>
            </div>
            <div class="wizard-step" id="authStep3">
                <label for="username">نام کاربری</label>
                <input type="text" id="username" placeholder="نام کاربری خود را وارد کنید" required>
                <div class="username-strength" id="usernameStrength"></div>
                <p class="error" id="usernameError">نام کاربری معتبر وارد کنید (حداقل 3 کاراکتر، فقط حروف و اعداد).</p>
                <h3>انتخاب کاراکتر</h3>
                <div class="character-grid">
                    <div class="character-card" data-char="🍎">🍎</div>
                    <div class="character-card" data-char="🍕">🍕</div>
                    <div class="character-card" data-char="🍔">🍔</div>
                    <div class="character-card" data-char="🍦">🍦</div>
                </div>
                <div class="wizard-buttons">
                    <button class="prev" id="prevToAuthStep2">قبلی</button>
                    <button id="confirmProfileBtn" disabled>تأیید</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Logout Modal -->
    <div class="logout-modal" id="logoutModal">
        <div class="logout-modal-content">
            <h2>از حساب کاربری خارج می‌شوید؟</h2>
            <p>با خروج از حساب کاربری به سبد خرید فعلی دسترسی نخواهید داشت. هر وقت بخواهید مجدد می‌توانید وارد شوید.</p>
            <div class="logout-buttons">
                <button class="confirm" id="confirmLogout">خروج</button>
                <button class="cancel" id="cancelLogout">انصراف</button>
            </div>
        </div>
    </div>
  
     <script src="js/login.js"></script>
    <div class="search-container" id="searchContainer">
        <input type="text" id="searchInputLegacy" placeholder="جست‌وجوی محصولات، دسته‌بندی‌ها..." aria-label="جست‌وجوی محصولات" />
        <div class="search-results" id="searchResults"></div>
    </div>
    <main>
        <div class="wizard-container">
            <div class="wizard-header">
                <h1><i class="fas fa-shopping-cart"></i> تکمیل سفارش</h1>
                <p>مراحل تکمیل سفارش خود را دنبال کنید</p>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-text">محصولات</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-text">آدرس</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-text">بسته‌بندی و پرداخت</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-text">تایید نهایی</div>
                </div>
            </div>
            <div class="progress-percentage" id="progressPercentage">25% تکمیل</div>
            <div class="wizard-content">
                <!-- Step 1: Products + Subtotal -->
                <div class="step-content active" id="wizardStep1">
                    <div class="products-container">
                        <div class="products-header">
                            <h2>محصولات انتخابی</h2>
                        </div>
                      
                        <div id="cart-container">
                            <!-- Dynamic products will be loaded here -->
                        </div>
                    </div>
                  
                    <div class="order-summary-box">
                        <h3><i class="fas fa-file-invoice"></i> خلاصه سفارش</h3>
                        <div class="summary-item">
                            <span class="summary-label">جمع کل محصولات:</span>
                            <span class="summary-value" data-type="subtotal">۸۸۰,۰۰۰ تومان</span>
                        </div>
                        <div class="summary-item grand-total">
                            <span class="summary-label">جمع کل:</span>
                            <span class="summary-value" data-type="total">۸۸۰,۰۰۰ تومان</span>
                        </div>
                    </div>
                  
                    <div class="action-buttons">
                        <button class="btn btn-prev" disabled>
                            <i class="fas fa-arrow-right"></i> قبلی
                        </button>
                        <button class="btn btn-next" id="nextToWizardStep2">
                            <i class="fas fa-arrow-left"></i> مرحله بعد
                        </button>
                    </div>
                </div>
                <!-- Step 2: Address -->
                <div class="step-content" id="wizardStep2">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="firstName" class="required">نام</label>
                                <input type="text" id="firstName" class="form-control" placeholder="نام خود را وارد کنید" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="lastName" class="required">نام خانوادگی</label>
                                <input type="text" id="lastName" class="form-control" placeholder="نام خانوادگی خود را وارد کنید" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="province" class="required">استان</label>
                        <input type="text" id="province" class="form-control" value="آذربایجان شرقی" readonly>
                    </div>
                    <div class="form-group">
                        <label for="city" class="required">شهر</label>
                        <select id="city" class="form-control" required>
                            <option value="">انتخاب شهر</option>
                            <option value="تبریز">تبریز</option>
                            <option value="اسکو">اسکو</option>
                            <option value="لیقوان">لیقوان</option>
                            <option value="بستان آباد">بستان آباد</option>
                            <option value="شبستر">شبستر</option>
                            <option value="آذرشهر">آذرشهر</option>
                            <option value="ورزقان">ورزقان</option>
                            <option value="بناب">بناب</option>
                            <option value="مرند">مرند</option>
                            <option value="اهر">اهر</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="address" class="required">آدرس کامل</label>
                        <textarea id="address" class="form-control" rows="3" placeholder="مثال: خیابان اصلی، کوچه دوم، پلاک 15، طبقه سوم" required></textarea>
                        <div class="address-note">
                            <i class="fas fa-exclamation-circle"></i> اگر این بخش تغییر کند و با موقعیت واقعی شما مطابقت نداشته باشد، تحویل محصول ممکن است با مشکل مواجه شود.
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="phone" class="required">شماره تماس</label>
                                <input type="tel" id="phone" class="form-control" placeholder="مثال: 09123456789" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="deliveryTime" class="required">زمان تحویل</label>
                                <input type="text" id="deliveryTime" class="form-control" required>
                                <div class="time-error" id="timeError">زمان تحویل باید حداقل یک روز آینده باشد</div>
                                <div class="delivery-time-info">
                                    <i class="fas fa-info-circle"></i> زمان تحویل باید حداقل یک روز آینده باشد
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-prev" id="prevToWizardStep1">
                            <i class="fas fa-arrow-right"></i> قبلی
                        </button>
                        <button class="btn btn-next" id="nextToWizardStep3" disabled>
                            <i class="fas fa-arrow-left"></i> مرحله بعد
                        </button>
                    </div>
                </div>
                <!-- Step 3: Packaging + Payment + Discount + Full Summary -->
                <div class="step-content" id="wizardStep3">
                    <div class="discount-section">
                        <h3><i class="fas fa-ticket-alt"></i> کد تخفیف</h3>
                        <div class="discount-input-group">
                            <input type="text" class="discount-input" placeholder="کد تخفیف خود را وارد کنید" aria-label="وارد کردن کد تخفیف">
                            <button class="discount-btn" aria-label="اعمال کد تخفیف">اعمال کد</button>
                        </div>
                    </div>
                  
                    <div class="packaging-section">
                        <h3 class="packaging-title">انتخاب نوع بسته‌بندی برای سفارش شما</h3>
                        <div class="packaging-options">
                            <button class="packaging-option" data-packaging="wooden" aria-label="انتخاب بسته‌بندی چارچوبی">
                                <img src="https://placehold.co/150x120/8B4513/FFFFFF?text=چارچوبی" alt="چارچوبی" class="packaging-image" id="wooden-image">
                                <div class="packaging-name">چارچوبی</div>
                                <div class="packaging-description">چارچوب طبیعی با ظرافت و زیبایی خاص برای مراسم‌های رسمی</div>
                                <span class="packaging-label rental">اجاره‌ای</span>
                            </button>
                            <button class="packaging-option selected" data-packaging="turquoise" aria-label="انتخاب بسته‌بندی فیروزه‌ای">
                                <img src="https://placehold.co/150x120/40E0D0/FFFFFF?text=فیروزه‌ای" alt="فیروزه‌ای" class="packaging-image" id="turquoise-image">
                                <div class="packaging-name">فیروزه‌ای</div>
                                <div class="packaging-description">جعبه‌های رنگی فیروزه‌ای با طراحی مدرن و جذاب</div>
                                <span class="packaging-label free">رایگان</span>
                            </button>
                            <button class="packaging-option" data-packaging="iron" aria-label="انتخاب بسته‌بندی آهنی">
                                <img src="https://placehold.co/150x120/A9A9A9/FFFFFF?text=آهنی" alt="آهنی" class="packaging-image" id="iron-image">
                                <div class="packaging-name">آهنی</div>
                                <div class="packaging-description">سینی‌های آهنی با پایه‌های مقاوم برای سرو حرفه‌ای</div>
                                <span class="packaging-label rental">اجاره‌ای</span>
                            </button>
                        </div>
                        <div class="packaging-note">
                            اجاره‌ای به معنای ارائه کالا در قبال واگذاری کارت ملی است
                        </div>
                    </div>
                  
                    <div class="payment-methods">
                        <h3><i class="fas fa-money-bill-wave"></i> روش پرداخت</h3>
                        <div class="payment-options">
                            <button class="payment-option selected" data-method="online" aria-label="انتخاب پرداخت آنلاین">
                                <i class="fas fa-credit-card"></i> پرداخت آنلاین
                            </button>
                            <button class="payment-option disabled" data-method="cod" aria-label="انتخاب پرداخت در محل">
                                <i class="fas fa-wallet"></i> پرداخت در محل
                            </button>
                        </div>
                        <div class="payment-description" id="paymentDescription">
                            <p>پس از پرداخت موفق، فاکتور رسمی صادر خواهد شد که قابل پیگیری قانونی است.</p>
                        </div>
                        <div class="trust-section">
                            <p>پرداخت شما توسط درگاه امن بانکی شاپرک رمزگذاری می‌شود</p>
                            <div class="trust-logos">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6e/Zarinpal_Logo.PNG" alt="Zarinpal">
                                <img src="https://seeklogo.com/images/N/nextpay-logo-9F0C7A4A0C-seeklogo.com.png" alt="NextPay">
                                <img src="https://seeklogo.com/images/S/shaparak-logo-0E87F3C6A2-seeklogo.com.png" alt="Shaparak">
                                <img src="https://www.svgrepo.com/download/329593/enamad.svg" alt="eNamad">
                            </div>
                        </div>
                    </div>
                  
                    <div class="order-summary-box">
                        <h3><i class="fas fa-file-invoice"></i> خلاصه سفارش</h3>
                        <div class="summary-item">
                            <span class="summary-label">جمع کل محصولات:</span>
                            <span class="summary-value" data-type="subtotal">۸۸۰,۰۰۰ تومان</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">تخفیف:</span>
                            <span class="summary-value" data-type="discount">۰ تومان</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">هزینه ارسال:</span>
                            <span class="summary-value" data-type="shipping">۳۰,۰۰۰ تومان</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">مالیات:</span>
                            <span class="summary-value" data-type="tax">۸۰,۰۰۰ تومان</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">بسته‌بندی:</span>
                            <span class="summary-value" id="packaging-summary">فیروزه‌ای (رایگان)</span>
                        </div>
                        <div class="summary-item" id="cod-upfront" style="display: none;">
                            <span class="summary-label">پرداخت آنلاین (۲/۳):</span>
                            <span class="summary-value" data-type="cod-upfront">۰ تومان</span>
                        </div>
                        <div class="summary-item" id="cod-remaining" style="display: none;">
                            <span class="summary-label">پرداخت در محل (۱/۳):</span>
                            <span class="summary-value" data-type="cod-remaining">۰ تومان</span>
                        </div>
                        <div class="summary-item grand-total">
                            <span class="summary-label">جمع کل:</span>
                            <span class="summary-value" data-type="total">۹۹۰,۰۰۰ تومان</span>
                        </div>
                    </div>
                  
                    <div class="action-buttons">
                        <button class="btn btn-prev" id="prevToWizardStep2">
                            <i class="fas fa-arrow-right"></i> قبلی
                        </button>
                        <button class="btn btn-next" id="nextToWizardStep4">
                            <i class="fas fa-arrow-left"></i> مرحله بعد
                        </button>
                    </div>
                </div>
                <!-- Step 4: Final Confirmation -->
                <div class="step-content" id="wizardStep4">
                    <div class="payment-confirmation">
                        <div class="payment-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2>فاکتور رسمی سفارش</h2>
                        <p>لطفاً اطلاعات زیر را بررسی کنید و سفارش خود را تایید نمایید</p>
                      
                        <div class="payment-amount" id="finalTotal">
                            ۹۹۰,۰۰۰ تومان
                        </div>
                      
                        <div class="products-list">
                            <h3>لیست محصولات</h3>
                            <div id="finalProductsList"></div>
                        </div>
                      
                        <div class="payment-details">
                            <div class="detail-row">
                                <span class="detail-label">نام کامل:</span>
                                <span class="detail-value" id="fullNameDisplay">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">جمع کل محصولات:</span>
                                <span class="detail-value" id="finalSubtotal">۸۸۰,۰۰۰ تومان</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">تخفیف:</span>
                                <span class="detail-value" id="finalDiscount">۰ تومان</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">هزینه ارسال:</span>
                                <span class="detail-value" id="finalShipping">۳۰,۰۰۰ تومان</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">مالیات:</span>
                                <span class="detail-value" id="finalTax">۸۰,۰۰۰ تومان</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">بسته‌بندی:</span>
                                <span class="detail-value" id="packagingDisplay">فیروزه‌ای (رایگان)</span>
                            </div>
                            <div class="detail-row" id="finalCodUpfront" style="display: none;">
                                <span class="detail-label">پرداخت آنلاین (۲/۳):</span>
                                <span class="detail-value" data-type="cod-upfront">۰ تومان</span>
                            </div>
                            <div class="detail-row" id="finalCodRemaining" style="display: none;">
                                <span class="detail-label">پرداخت در محل (۱/۳):</span>
                                <span class="detail-value">۰ تومان</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">روش پرداخت:</span>
                                <span class="detail-value" id="paymentMethodDisplay">پرداخت آنلاین</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">آدرس تحویل:</span>
                                <span class="detail-value" id="deliveryAddressDisplay">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">شماره تماس:</span>
                                <span class="detail-value" id="phoneDisplay">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">زمان تحویل:</span>
                                <span class="detail-value" id="deliveryTimeDisplay">-</span>
                            </div>
                        </div>
                      
                        <div class="invoice-note">
                            <i class="fas fa-info-circle"></i> پس از تایید نهایی، فاکتور رسمی صادر خواهد شد که قابل پیگیری قانونی است.
                        </div>
                    </div>
                  
                    <div class="action-buttons">
                        <button class="btn btn-prev" id="prevToWizardStep3">
                            <i class="fas fa-arrow-right"></i> قبلی
                        </button>
                        <button class="btn btn-confirm" id="confirmOrder">
                            <i class="fas fa-check"></i> تایید و پرداخت
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <h2><i class="fas fa-building"></i> فیروزه</h2>
        <p>فیروزه فروشگاه آنلاین مزه، فینگرفود و همه نیازهای دورهمی و مهمونیه. هر چیزی برای یک شب به‌یادماندنی لازم دارید، همین جاست!</p>
        <div class="links">
            <a href="about.html"><i class="fas fa-info-circle"></i> درباره فیروزه</a>
            <a href="index.html#contact"><i class="fas fa-phone"></i> تماس با فیروزه</a>
            <a href="index.html#collaboration"><i class="fas fa-handshake"></i> همکاری با فیروزه</a>
            <a href="index.html#faq"><i class="fas fa-question-circle"></i> سوالات متداول</a>
        </div>
        <div class="contact-info">
            <i class="fas fa-phone"></i> تماس: 041-33367052 | <i class="fab fa-whatsapp"></i> واتس‌اپ:09142830328
        </div>
        <p id="clock"><i class="fas fa-clock"></i> در حال دریافت زمان…</p>
        <div class="copyright">
            © ۱۴۰۴ FingerFood Firoozeh - کلیه حقوق محفوظ است.
        </div>
        <div class="social-bar">
            <div class="logo-box"><img src="https://placehold.co/30x30/26A69A/FFFFFF?text=F" alt="لوگوی فینگرفود فیروزه"></div>
            <a href="mailto:firouzeh.foodgroup@gmail.com" class="social-box">
                <i class="fas fa-envelope"></i>
                ایمیل
            </a>
            <a href="https://instagram.com/fingerfood_firouzeh" class="social-box" target="_blank">
                <i class="fab fa-instagram"></i>
                اینستاگرام
            </a>
            <a href="https://wa.me/09142830328" class="social-box" target="_blank">
                <i class="fab fa-whatsapp"></i>
                واتس اپ
            </a>
            <a href="tel:09142830328" class="social-box">
                <i class="fas fa-phone"></i>
                تماس
            </a>
            <a href="about.html" class="social-box">
                <i class="fas fa-award"></i>
                مجوزها
            </a>
        </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/persian-date@1.1.0/dist/persian-date.min.js"></script>
    <script src="https://unpkg.com/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
    <script>
        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {}); // Silent fail
        }
        // DOM Elements Cache
        const elements = {
            body: document.body,
            menuToggle: document.querySelector('.menu-icon'),
            sideMenu: document.getElementById('sideMenu'),
            closeBtn: document.querySelector('.close-btn'),
            overlay: document.getElementById('overlay'),
            searchContainer: document.getElementById('searchContainer'),
            searchInputLegacy: document.getElementById('searchInputLegacy'),
            searchResults: document.getElementById('searchResults'),
            searchInput: document.getElementById("searchInput"),
            promoText: document.getElementById("promoText"),
            promoTextMobile: document.getElementById("promoTextMobile"),
            clearSearch: document.getElementById("clearSearch"),
            mainImage: document.getElementById('mainImage'),
            thumbnails: document.querySelectorAll('.product-thumbnail'),
            quantityInput: document.getElementById('quantity'),
            sliderTrack: document.getElementById('sliderTrack'),
            sliderContainer: document.querySelector('.slider-container'),
            promoCode: document.getElementById('promoCode'),
            discount: document.getElementById('discount'),
            totalPrice: document.getElementById('total-price'),
            userProfile: document.getElementById('userProfile'),
            profileIcon: document.getElementById('profileIcon'),
            userMenu: document.getElementById('userMenu'),
            userAvatar: document.getElementById('userAvatar'),
            userName: document.getElementById('userName'),
            logoutBtn: document.getElementById('logoutBtn'),
            logoutModal: document.getElementById('logoutModal'),
            confirmLogout: document.getElementById('confirmLogout'),
            cancelLogout: document.getElementById('cancelLogout'),
            authModal: document.getElementById('authModal'),
            closeAuthModal: document.getElementById('closeAuthModal'),
            authStep1: document.getElementById('authStep1'),
            authStep2: document.getElementById('authStep2'),
            authStep3: document.getElementById('authStep3'),
            nextToAuthStep2: document.getElementById('nextToAuthStep2'),
            prevToAuthStep1: document.getElementById('prevToAuthStep1'),
            nextToAuthStep3: document.getElementById('nextToAuthStep3'),
            prevToAuthStep2: document.getElementById('prevToAuthStep2'),
            authPhone: document.getElementById('authPhone'),
            authPhoneError: document.getElementById('authPhoneError'),
            authSuccess: document.getElementById('authSuccess'),
            authCode: document.getElementById('authCode'),
            authCodeError: document.getElementById('authCodeError'),
            authTimer: document.getElementById('authTimer'),
            authCountdown: document.getElementById('authCountdown'),
            username: document.getElementById('username'),
            usernameError: document.getElementById('usernameError'),
            usernameStrength: document.getElementById('usernameStrength'),
            characterCards: document.querySelectorAll('.character-card'),
            confirmProfileBtn: document.getElementById('confirmProfileBtn'),
            toggleAuthCode: document.getElementById('toggleAuthCode'),
            resendCodeBtn: document.getElementById('resendCodeBtn'),
            captchaQuestion: document.getElementById('captchaQuestion'),
            captchaAnswer: document.getElementById('captchaAnswer'),
            captchaError: document.getElementById('captchaError'),
            firstName: document.getElementById('firstName'),
            lastName: document.getElementById('lastName'),
            province: document.getElementById('province'),
            city: document.getElementById('city'),
            address: document.getElementById('address'),
            phone: document.getElementById('phone'),
            deliveryTime: document.getElementById('deliveryTime'),
            timeError: document.getElementById('timeError'),
            fullNameDisplay: document.getElementById('fullNameDisplay'),
            paymentMethodDisplay: document.getElementById('paymentMethodDisplay'),
            deliveryAddressDisplay: document.getElementById('deliveryAddressDisplay'),
            packagingDisplay: document.getElementById('packagingDisplay'),
            phoneDisplay: document.getElementById('phoneDisplay'),
            deliveryTimeDisplay: document.getElementById('deliveryTimeDisplay'),
            finalSubtotal: document.getElementById('finalSubtotal'),
            finalDiscount: document.getElementById('finalDiscount'),
            finalShipping: document.getElementById('finalShipping'),
            finalTax: document.getElementById('finalTax'),
            finalTotal: document.getElementById('finalTotal'),
            finalCodUpfront: document.getElementById('finalCodUpfront'),
            finalCodRemaining: document.getElementById('finalCodRemaining'),
            finalProductsList: document.getElementById('finalProductsList'),
            progressFill: document.getElementById('progressFill'),
            progressPercentage: document.getElementById('progressPercentage'),
            steps: document.querySelectorAll('.step'),
            stepContents: document.querySelectorAll('.step-content'),
            nextToWizardStep2: document.getElementById('nextToWizardStep2'),
            prevToWizardStep1: document.getElementById('prevToWizardStep1'),
            nextToWizardStep3: document.getElementById('nextToWizardStep3'),
            prevToWizardStep2: document.getElementById('prevToWizardStep2'),
            nextToWizardStep4: document.getElementById('nextToWizardStep4'),
            prevToWizardStep3: document.getElementById('prevToWizardStep3'),
            confirmOrder: document.getElementById('confirmOrder'),
            woodenImage: document.getElementById('wooden-image'),
            turquoiseImage: document.getElementById('turquoise-image'),
            ironImage: document.getElementById('iron-image')
        };
        // Product State
        let basePrice = 45000;
        let quantity = 1;
        let currentSlide = 0;
        const slideWidth = 220; // Item width + gap
        let cart = {
            biryani: { qty: 1, price: 38000, type: 'مرغ بریانی' },
            pizza: { qty: 1, price: 46000, type: 'پیتزا کروست' },
            drink: { qty: 1, price: 21500, type: 'نوشیدنی' }
        };
        let total = 105500;
        let currentPromoIndex = 0;
        let discountAmount = 0;
        // Auth State
        let authCountdownInterval;
        let authModalShown = false;
        let userData = JSON.parse(sessionStorage.getItem('userData')) || null;
        let currentPhone = '';
        let isNewUser = false;
        let captchaNum1, captchaNum2, captchaResult;
        let failedAttempts = parseInt(sessionStorage.getItem('failedAttempts')) || 0;
        let lockTimer = 0;
        const promoMessages = [
            "⚡بهترین آموزش‌های فینگر فود و سلامت غذایی!",
            "🍕 غذاهای تازه و خوشمزه هر روز!",
            "⭐ تخفیف ویژه برای مشتریان وفادار!",
            "🚚فیروزه؛ سریع، تازه، خوش‌سلیقه"
        ];
        // Search suggestions
        const searchSuggestions = [
            "مینی برگر",
            "سالاد کپرسه",
            "پیتزا کروست",
            "مرغ بریانی",
            "لیموناد",
            "دسر شکلاتی",
            "مزه‌های گرم",
            "سالاد فصل",
            "سس گوجه",
            "باکس الگانت"
        ];
        // Utility Functions
        function updatePrice() {
            if (!elements) return; // Safe check
            let extra = 0;
            document.querySelectorAll('.ingredient.active').forEach(ing => {
                const match = ing.querySelector('span').textContent.match(/(\d+,?\d*)/);
                extra += match ? parseInt(match[1].replace(/,/g, '')) : 0;
            });
            const itemPriceEl = document.getElementById('item-price');
            if (itemPriceEl) {
                itemPriceEl.textContent = ((basePrice + extra) * quantity).toLocaleString();
            }
        }
        // Image Gallery
        function changeImage(thumbnail, src) {
            elements.thumbnails.forEach(thumb => thumb.classList.remove('active'));
            thumbnail.classList.add('active');
            if (elements.mainImage) {
                elements.mainImage.src = src;
            }
        }
        // Quantity Controls
        function changeQuantity(change) {
            quantity = Math.max(1, quantity + change);
            if (elements.quantityInput) {
                elements.quantityInput.value = quantity;
            }
            updatePrice();
        }
        function updateQuantity(value) {
            quantity = Math.max(1, parseInt(value) || 1);
            if (elements.quantityInput) {
                elements.quantityInput.value = quantity;
            }
            updatePrice();
        }
        // Menu Controls (Fixed Scroll Issue)
        function openMenu() {
            if (elements.sideMenu) elements.sideMenu.classList.add('active');
            if (elements.overlay) elements.overlay.classList.add('active');
            if (elements.body) elements.body.classList.add('menu-open');
            if (elements.menuToggle) {
                elements.menuToggle.setAttribute('aria-expanded', 'true');
                elements.menuToggle.setAttribute('aria-label', 'بستن منو');
            }
            if (elements.sideMenu) {
                elements.sideMenu.setAttribute('aria-hidden', 'false');
                elements.sideMenu.scrollTop = 0; // Reset scroll position
                elements.sideMenu.focus();
            }
            if (elements.body) elements.body.style.overflow = 'hidden'; // Lock body scroll
        }
        function closeMenu() {
            if (elements.sideMenu) elements.sideMenu.classList.remove('active');
            if (elements.overlay) elements.overlay.classList.remove('active');
            if (elements.body) elements.body.classList.remove('menu-open');
            if (elements.menuToggle) {
                elements.menuToggle.setAttribute('aria-expanded', 'false');
                elements.menuToggle.setAttribute('aria-label', 'باز کردن منو');
            }
            if (elements.sideMenu) elements.sideMenu.setAttribute('aria-hidden', 'true');
            if (elements.body) elements.body.style.overflow = ''; // Restore body scroll
            if (elements.menuToggle) elements.menuToggle.focus();
        }
        function openSearch() {
            if (elements.searchContainer) elements.searchContainer.classList.add('active');
            if (elements.overlay) elements.overlay.classList.add('active');
            if (elements.body) elements.body.style.overflow = 'hidden';
            if (elements.searchInputLegacy) elements.searchInputLegacy.focus();
        }
        function closeSearch() {
            if (elements.searchContainer) elements.searchContainer.classList.remove('active');
            if (elements.overlay) elements.overlay.classList.remove('active');
            if (elements.body) elements.body.style.overflow = '';
            if (elements.searchInputLegacy) elements.searchInputLegacy.value = '';
            if (elements.searchResults) elements.searchResults.innerHTML = '';
        }
        function performSearch(query) {
            if (!elements.searchResults) return;
            elements.searchResults.innerHTML = '';
            if (!query.trim()) {
                elements.searchResults.innerHTML = '<div class="no-results">لطفاً عبارتی برای جست‌وجو وارد کنید</div>';
                return;
            }
            const content = [
                ...document.querySelectorAll('.category-card strong, .category-card p, h1, p.lead, footer p, footer a, .story-content')
            ].map(el => ({
                text: el.textContent.trim(),
                element: el
            }));
            const results = content.filter(item => item.text.toLowerCase().includes(query.toLowerCase()));
            if (results.length === 0) {
                elements.searchResults.innerHTML = '<div class="no-results">نتیجه‌ای یافت نشد</div>';
                return;
            }
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = 'result-item';
                div.textContent = result.text.slice(0, 50) + (result.text.length > 50 ? '...' : '');
                div.addEventListener('click', () => {
                    result.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    closeSearch();
                });
                elements.searchResults.appendChild(div);
            });
        }
        function showSearchSuggestions(query) {
            if (!elements.searchResults) return;
            elements.searchResults.innerHTML = '';
            if (!query.trim()) {
                elements.searchResults.innerHTML = '<div class="no-results">لطفاً عبارتی برای جست‌وجو وارد کنید</div>';
                return;
            }
            const suggestions = searchSuggestions.filter(item =>
                item.toLowerCase().includes(query.toLowerCase())
            );
            if (suggestions.length === 0) {
                elements.searchResults.innerHTML = '<div class="no-results">نتیجه‌ای یافت نشد</div>';
                return;
            }
            suggestions.forEach(suggestion => {
                const div = document.createElement('div');
                div.className = 'result-item';
                div.textContent = suggestion;
                div.addEventListener('click', () => {
                    if (elements.searchInput) elements.searchInput.value = suggestion;
                    if (elements.searchResults) elements.searchResults.innerHTML = '';
                    if (elements.clearSearch) elements.clearSearch.classList.add('active');
                });
                elements.searchResults.appendChild(div);
            });
        }
        function changePromoText() {
            const message = promoMessages[currentPromoIndex];
            if (elements.promoText) elements.promoText.innerHTML = `<i class="fas fa-bolt"></i> ${message}`;
            if (elements.promoTextMobile) elements.promoTextMobile.innerHTML = `<i class="fas fa-bolt"></i> ${message}`;
            currentPromoIndex = (currentPromoIndex + 1) % promoMessages.length;
        }
        function updateTime() {
            const clock = document.getElementById('clock');
            if (!clock) return;
            if (typeof persianDate === 'undefined') {
                clock.textContent = 'خطا در بارگذاری تاریخ';
                return;
            }
            const now = new Date();
            const options = {
                timeZone: 'Asia/Tehran',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            const timeStr = now.toLocaleTimeString('fa-IR', options);
            const persianDateObj = new persianDate(now);
            const persianDateStr = persianDateObj.format('D MMMM YYYY');
            clock.innerHTML = `${persianDateStr} - ${timeStr}`;
        }
        // Slider Functions
        function slideNext() {
            if (!elements.sliderTrack) return;
            const items = elements.sliderTrack.children.length;
            currentSlide = (currentSlide + 1) % items;
            updateSlider();
        }
        function slidePrev() {
            if (!elements.sliderTrack) return;
            const items = elements.sliderTrack.children.length;
            currentSlide = (currentSlide - 1 + items) % items;
            updateSlider();
        }
        function updateSlider() {
            if (elements.sliderTrack) {
                elements.sliderTrack.style.transform = `translateX(-${currentSlide * slideWidth}px)`;
            }
        }
        // Cart Functions
        function loadPersonalization() {
            const history = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            const recommendationsTitle = document.querySelector('.recommendations h2');
            if (recommendationsTitle && history.length > 0) {
                const lastOrder = history[history.length - 1];
                recommendationsTitle.textContent = `پیشنهادهای همراه (شما عاشق ${lastOrder.type} هستید)`;
            }
        }
        function addToCart(item = 'main', price = basePrice, type = 'پاستا') {
            if (item === 'main') {
                let extra = 0;
                document.querySelectorAll('.ingredient.active').forEach(ing => {
                    const match = ing.querySelector('span').textContent.match(/(\d+,?\d*)/);
                    extra += match ? parseInt(match[1].replace(/,/g, '')) : 0;
                });
                cart[item] = { qty: quantity, price: basePrice + extra, type };
                // Save to history
                const history = JSON.parse(localStorage.getItem('orderHistory') || '[]');
                history.push({ type, date: new Date().toISOString() });
                localStorage.setItem('orderHistory', JSON.stringify(history));
            } else {
                if (!cart[item]) cart[item] = { qty: 0, price, type: cart[item]?.type || item };
                cart[item].qty += 1;
            }
            updateCart();
            alert('به سبد اضافه شد!');
        }
        function updateCart() {
            total = Object.values(cart).reduce((sum, item) => sum + (item.price * item.qty), 0);
            // Apply discount if exists
            let discountedTotal = total;
            if (discountAmount > 0) {
                discountedTotal = total - discountAmount;
            }
            if (elements.totalPrice) {
                elements.totalPrice.textContent = discountedTotal.toLocaleString() + ' تومان';
            }
            const itemCount = Object.values(cart).reduce((sum, item) => sum + item.qty, 0);
            const cartSelect = document.querySelector('.cart-header select');
            if (cartSelect) {
                cartSelect.innerHTML = `<option>${itemCount} مورد</option>`;
            }
            // Update quantities in UI
            Object.keys(cart).forEach(key => {
                const qtyEl = document.getElementById(`${key}-qty`);
                if (qtyEl) qtyEl.textContent = cart[key].qty;
            });
        }
        function updateQty(item, change) {
            if (cart[item]) {
                cart[item].qty = Math.max(1, cart[item].qty + change);
                const qtyEl = document.getElementById(`${item}-qty`);
                if (qtyEl) qtyEl.textContent = cart[item].qty;
                updateCart();
            }
        }
        function applyPromo() {
            if (!elements.promoCode || !elements.discount || !elements.totalPrice) return;
            const code = elements.promoCode.value.trim();
            if (code === 'FIROUZEH10') {
                discountAmount = total * 0.1;
                elements.discount.textContent = `تخفیف: -${Math.round(discountAmount).toLocaleString()} تومان`;
                const discountedTotal = total - discountAmount;
                elements.totalPrice.textContent = discountedTotal.toLocaleString() + ' تومان';
            } else if (code === 'NEWCUSTOMER') {
                discountAmount = 20000;
                elements.discount.textContent = `تخفیف: -${discountAmount.toLocaleString()} تومان`;
                const discountedTotal = total - discountAmount;
                elements.totalPrice.textContent = discountedTotal.toLocaleString() + ' تومان';
            } else {
                discountAmount = 0;
                elements.discount.textContent = 'کد تخفیف نامعتبر است';
                elements.totalPrice.textContent = total.toLocaleString() + ' تومان';
            }
        }
        function confirmOrder() {
            // Mock reCAPTCHA
            console.log('reCAPTCHA token generated');
            alert('سفارش شما ثبت شد! به صفحه پرداخت منتقل می‌شوید.');
        }
        // Scroll Animations
        function initScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationPlayState = 'running';
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.rec-item, .product-detail, .other-product-item').forEach(el => observer.observe(el));
        }
        // Auth Functions
        function openAuthModalFunc() {
            if (elements.authModal) elements.authModal.classList.add('active');
            if (elements.overlay) elements.overlay.classList.add('active');
            if (elements.body) elements.body.style.overflow = 'hidden';
            authModalShown = true;
            resetAuthForm();
            generateCaptcha();
        }
        function closeAuthModalFunc() {
            if (elements.authModal) elements.authModal.classList.remove('active');
            if (elements.overlay) elements.overlay.classList.remove('active');
            if (elements.body) elements.body.style.overflow = '';
            resetAuthForm();
        }
        function resetAuthForm() {
            if (elements.authPhone) elements.authPhone.value = '';
            if (elements.authCode) elements.authCode.value = '';
            if (elements.username) elements.username.value = '';
            if (elements.captchaAnswer) elements.captchaAnswer.value = '';
            if (elements.authPhoneError) elements.authPhoneError.style.display = 'none';
            if (elements.authCodeError) elements.authCodeError.style.display = 'none';
            if (elements.usernameError) elements.usernameError.style.display = 'none';
            if (elements.captchaError) elements.captchaError.style.display = 'none';
            if (elements.authSuccess) elements.authSuccess.style.display = 'none';
            if (elements.authTimer) elements.authTimer.style.display = 'none';
            if (elements.resendCodeBtn) elements.resendCodeBtn.style.display = 'none';
            if (elements.authStep1) elements.authStep1.classList.add('active');
            if (elements.authStep2) elements.authStep2.classList.remove('active');
            if (elements.authStep3) elements.authStep3.classList.remove('active');
            elements.characterCards.forEach(card => card.classList.remove('selected'));
            if (authCountdownInterval) clearInterval(authCountdownInterval);
            failedAttempts = 0;
            sessionStorage.setItem('failedAttempts', failedAttempts);
            updateButtonStates();
            updateUsernameStrength();
        }
        function validatePhone(phone) {
            const regex = /^09[0-9]{9}$/;
            return regex.test(phone);
        }
        function validateCode(code) {
            return /^[0-9]{6}$/.test(code);
        }
        function validateUsername(name) {
            return /^[a-zA-Z0-9]{3,}$/.test(name);
        }
        function validateCaptcha(answer) {
            return parseInt(answer) === captchaResult;
        }
        function maskInput(input, regex) {
            if (input) input.value = input.value.replace(regex, '');
        }
        function updateButtonStates() {
            if (elements.nextToAuthStep2) elements.nextToAuthStep2.disabled = !validatePhone(elements.authPhone?.value || '') || !validateCaptcha(elements.captchaAnswer?.value || '');
            if (elements.nextToAuthStep3) elements.nextToAuthStep3.disabled = !validateCode(elements.authCode?.value || '');
            if (elements.confirmProfileBtn) elements.confirmProfileBtn.disabled = !validateUsername(elements.username?.value || '') || !document.querySelector('.character-card.selected');
        }
        function updateUsernameStrength() {
            if (!elements.username || !elements.usernameStrength) return;
            const name = elements.username.value;
            if (name.length < 3) {
                elements.usernameStrength.className = 'username-strength weak';
            } else if (name.length < 6) {
                elements.usernameStrength.className = 'username-strength medium';
            } else {
                elements.usernameStrength.className = 'username-strength strong';
            }
        }
        function generateCaptcha() {
            captchaNum1 = Math.floor(Math.random() * 10) + 1;
            captchaNum2 = Math.floor(Math.random() * 10) + 1;
            captchaResult = captchaNum1 + captchaNum2;
            if (elements.captchaQuestion) elements.captchaQuestion.textContent = `حاصل جمع ${captchaNum1} + ${captchaNum2} چیست؟`;
        }
        function showSpinner(button) {
            if (button) {
                button.innerHTML = '<div class="spinner"></div>';
                button.disabled = true;
            }
        }
        function hideSpinner(button, text) {
            if (button) {
                button.innerHTML = text;
                button.disabled = false;
            }
        }
        async function sendCode(phone) {
            try {
                const response = await fetch("http://127.0.0.1:8000/api/auth/send-otp/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                
                    },
                    body: JSON.stringify({ phone: phone }),
                });
                const data = await response.json();
                console.log('Send OTP response:', data);
                if (response.ok) {
                    return true; // موفقیت
                } else {
                    throw new Error(data.message || 'خطا در ارسال کد');
                }
            } catch (error) {
                console.error('Error sending OTP:', error);
                return false;
            }
        }
        async function verifyCode(code, phone) {
            try {
                const response = await fetch("http://127.0.0.1:8000/api/auth/verify-otp/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        
                    },
                    body: JSON.stringify({ phone: phone, code: code }),
                });
                const data = await response.json();
                console.log('Verify OTP response:', data);
                if (response.ok) {
                    // فرض کنیم backend user data یا token برمی‌گردونه
                    userData = data.user; // تنظیم بر اساس پاسخ backend
                    sessionStorage.setItem('userData', JSON.stringify(userData));
                    sessionStorage.setItem(`user_${phone}`, JSON.stringify(userData));
                    isNewUser = data.is_new_user || false; // اگر backend مشخص کنه
                    return true;
                } else {
                    throw new Error(data.message || 'کد نامعتبر');
                }
            } catch (error) {
                console.error('Error verifying OTP:', error);
                return false;
            }
        }
        function startCountdown(timerSeconds = 60) {
            let seconds = timerSeconds;
            if (elements.authCountdown) elements.authCountdown.innerHTML = seconds;
            if (elements.authTimer) elements.authTimer.style.display = 'block';
            if (elements.resendCodeBtn) elements.resendCodeBtn.style.display = 'none';
            authCountdownInterval = setInterval(() => {
                seconds--;
                if (elements.authCountdown) elements.authCountdown.innerHTML = seconds;
                if (seconds <= 0) {
                    clearInterval(authCountdownInterval);
                    if (elements.authTimer) elements.authTimer.style.display = 'none';
                    if (elements.resendCodeBtn) elements.resendCodeBtn.style.display = 'block';
                }
            }, 1000);
        }
        function updateUserUI() {
            if (userData) {
                if (elements.profileIcon) elements.profileIcon.style.display = 'none';
                const avatar = document.createElement('div');
                avatar.className = 'user-avatar';
                avatar.textContent = userData.character;
                if (elements.userProfile) elements.userProfile.appendChild(avatar);
                if (elements.userAvatar) elements.userAvatar.textContent = userData.character;
                if (elements.userName) elements.userName.textContent = escapeHTML(userData.username);
            } else {
                if (elements.userProfile && elements.userProfile.querySelector('.user-avatar')) {
                    elements.userProfile.querySelector('.user-avatar').remove();
                }
                if (elements.profileIcon) elements.profileIcon.style.display = 'block';
            }
        }
        function escapeHTML(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        }
        // Event Listeners
        if (elements.menuToggle) {
            elements.menuToggle.addEventListener('click', () => {
                if (elements.sideMenu && elements.sideMenu.classList.contains('active')) {
                    closeMenu();
                } else {
                    openMenu();
                }
            });
        }
        if (elements.closeBtn) elements.closeBtn.addEventListener('click', closeMenu);
        if (elements.userProfile) {
            elements.userProfile.addEventListener('click', (e) => {
                e.preventDefault();
                if (userData) {
                    if (elements.userMenu) elements.userMenu.classList.toggle('active');
                } else {
                    openAuthModalFunc();
                }
            });
        }
        if (elements.closeAuthModal) elements.closeAuthModal.addEventListener('click', closeAuthModalFunc);
        if (elements.authPhone) {
            elements.authPhone.addEventListener('input', (e) => {
                maskInput(e.target, /[^0-9]/g);
                if (elements.authPhoneError) elements.authPhoneError.style.display = validatePhone(e.target.value) ? 'none' : 'block';
                updateButtonStates();
            });
        }
        if (elements.captchaAnswer) {
            elements.captchaAnswer.addEventListener('input', () => {
                if (elements.captchaError) elements.captchaError.style.display = validateCaptcha(elements.captchaAnswer.value) ? 'none' : 'block';
                updateButtonStates();
            });
        }
        if (elements.nextToAuthStep2) {
            elements.nextToAuthStep2.addEventListener('click', async (e) => {
                e.preventDefault();
                if (!validateCaptcha(elements.captchaAnswer?.value || '')) {
                    if (elements.captchaError) elements.captchaError.style.display = 'block';
                    return;
                }
                if (elements.captchaError) elements.captchaError.style.display = 'none';
                const phone = elements.authPhone?.value || '';
                if (!validatePhone(phone)) {
                    if (elements.authPhoneError) elements.authPhoneError.style.display = 'block';
                    return;
                }
                if (elements.authPhoneError) elements.authPhoneError.style.display = 'none';
                currentPhone = phone;
                showSpinner(elements.nextToAuthStep2);
                const success = await sendCode(phone);
                hideSpinner(elements.nextToAuthStep2, 'بعدی');
                if (success) {
                    if (elements.authSuccess) elements.authSuccess.style.display = 'block';
                    if (elements.authStep1) elements.authStep1.classList.remove('active');
                    if (elements.authStep2) elements.authStep2.classList.add('active');
                    let timer = failedAttempts > 5 ? 300 : 60;
                    startCountdown(timer);
                } else {
                    if (elements.authPhoneError) {
                        elements.authPhoneError.textContent = 'خطا در ارسال کد. لطفاً دوباره امتحان کنید.';
                        elements.authPhoneError.style.display = 'block';
                    }
                }
            });
        }
        if (elements.prevToAuthStep1) {
            elements.prevToAuthStep1.addEventListener('click', () => {
                if (elements.authStep2) elements.authStep2.classList.remove('active');
                if (elements.authStep1) elements.authStep1.classList.add('active');
                if (elements.authSuccess) elements.authSuccess.style.display = 'none';
                if (elements.authTimer) elements.authTimer.style.display = 'none';
                if (elements.resendCodeBtn) elements.resendCodeBtn.style.display = 'none';
                if (authCountdownInterval) clearInterval(authCountdownInterval);
            });
        }
        if (elements.authCode) {
            elements.authCode.addEventListener('input', (e) => {
                maskInput(e.target, /[^0-9]/g);
                if (elements.authCodeError) elements.authCodeError.style.display = validateCode(e.target.value) ? 'none' : 'block';
                updateButtonStates();
            });
            elements.authCode.addEventListener('contextmenu', (e) => e.preventDefault());
            elements.authCode.addEventListener('paste', (e) => e.preventDefault());
            elements.authCode.addEventListener('copy', (e) => e.preventDefault());
        }
        if (elements.nextToAuthStep3) {
            elements.nextToAuthStep3.addEventListener('click', async (e) => {
                e.preventDefault();
                const code = elements.authCode?.value || '';
                showSpinner(elements.nextToAuthStep3);
                const success = await verifyCode(code, currentPhone);
                hideSpinner(elements.nextToAuthStep3, 'تأیید');
                if (success) {
                    failedAttempts = 0;
                    sessionStorage.setItem('failedAttempts', failedAttempts);
                    if (elements.authCodeError) elements.authCodeError.style.display = 'none';
                    if (isNewUser) {
                        if (elements.authStep2) elements.authStep2.classList.remove('active');
                        if (elements.authStep3) elements.authStep3.classList.add('active');
                        if (elements.username) elements.username.value = `user${currentPhone.slice(-4)}`;
                        updateUsernameStrength();
                        updateButtonStates();
                    } else {
                        updateUserUI();
                        closeAuthModalFunc();
                        alert('ورود موفق!');
                    }
                } else {
                    failedAttempts++;
                    sessionStorage.setItem('failedAttempts', failedAttempts);
                    if (elements.authCodeError) {
                        elements.authCodeError.textContent = `کد نامعتبر است. تلاش‌های باقی‌مانده: ${5 - (failedAttempts % 6)}`;
                        elements.authCodeError.style.display = 'block';
                    }
                    if (failedAttempts >= 5) {
                        console.error('Too many failed attempts');
                        if (elements.authCodeError) elements.authCodeError.textContent = 'تعداد تلاش‌ها بیش از حد مجاز. لطفاً بعداً امتحان کنید.';
                        if (elements.nextToAuthStep3) elements.nextToAuthStep3.disabled = true;
                        lockTimer = 300; // 5 minutes lock
                        setTimeout(() => {
                            if (elements.nextToAuthStep3) elements.nextToAuthStep3.disabled = false;
                            failedAttempts = 0;
                            sessionStorage.setItem('failedAttempts', failedAttempts);
                        }, lockTimer * 1000);
                    }
                }
            });
        }
        if (elements.resendCodeBtn) {
            elements.resendCodeBtn.addEventListener('click', async () => {
                const success = await sendCode(currentPhone);
                if (success) {
                    let timer = failedAttempts > 5 ? 300 : 60;
                    startCountdown(timer);
                }
            });
        }
        if (elements.toggleAuthCode) {
            elements.toggleAuthCode.addEventListener('click', () => {
                if (elements.authCode) {
                    const type = elements.authCode.type === 'password' ? 'text' : 'password';
                    elements.authCode.type = type;
                    elements.toggleAuthCode.classList.toggle('fa-eye-slash', type === 'password');
                }
            });
        }
        if (elements.prevToAuthStep2) {
            elements.prevToAuthStep2.addEventListener('click', () => {
                if (elements.authStep3) elements.authStep3.classList.remove('active');
                if (elements.authStep2) elements.authStep2.classList.add('active');
            });
        }
        if (elements.username) {
            elements.username.addEventListener('input', (e) => {
                maskInput(e.target, /[^a-zA-Z0-9]/g);
                if (elements.usernameError) elements.usernameError.style.display = validateUsername(e.target.value) ? 'none' : 'block';
                updateUsernameStrength();
                updateButtonStates();
            });
        }
        elements.characterCards.forEach(card => {
            card.addEventListener('click', () => {
                elements.characterCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                updateButtonStates();
            });
        });
        if (elements.confirmProfileBtn) {
            elements.confirmProfileBtn.addEventListener('click', () => {
                const name = elements.username?.value || '';
                const selectedChar = document.querySelector('.character-card.selected');
                if (!validateUsername(name)) {
                    if (elements.usernameError) elements.usernameError.style.display = 'block';
                    return;
                }
                if (!selectedChar) {
                    alert('لطفاً یک کاراکتر انتخاب کنید');
                    return;
                }
                if (elements.usernameError) elements.usernameError.style.display = 'none';
                userData = {
                    phone: currentPhone,
                    username: name,
                    character: selectedChar.dataset.char
                };
                sessionStorage.setItem(`user_${currentPhone}`, JSON.stringify(userData));
                sessionStorage.setItem('userData', JSON.stringify(userData));
                updateUserUI();
                closeAuthModalFunc();
                alert('ثبت‌نام موفق!');
            });
        }
        if (elements.logoutBtn) {
            elements.logoutBtn.addEventListener('click', () => {
                if (elements.userMenu) elements.userMenu.classList.remove('active');
                if (elements.logoutModal) elements.logoutModal.classList.add('active');
                if (elements.overlay) elements.overlay.classList.add('active');
            });
        }
        if (elements.confirmLogout) {
            elements.confirmLogout.addEventListener('click', () => {
                userData = null;
                sessionStorage.removeItem('userData');
                updateUserUI();
                if (elements.logoutModal) elements.logoutModal.classList.remove('active');
                if (elements.overlay) elements.overlay.classList.remove('active');
            });
        }
        if (elements.cancelLogout) {
            elements.cancelLogout.addEventListener('click', () => {
                if (elements.logoutModal) elements.logoutModal.classList.remove('active');
                if (elements.overlay) elements.overlay.classList.remove('active');
            });
        }
        const searchIcon = document.querySelector('.search-icon');
        if (searchIcon) {
            searchIcon.addEventListener('click', () => {
                if (elements.searchInput && elements.searchInput.value.trim()) {
                    console.log('جستجو برای:', elements.searchInput.value);
                } else {
                    openSearch();
                }
            });
        }
        if (elements.overlay) {
            elements.overlay.addEventListener('click', () => {
                closeMenu();
                closeSearch();
                if (elements.userMenu) elements.userMenu.classList.remove('active');
                if (elements.logoutModal) elements.logoutModal.classList.remove('active');
                closeAuthModalFunc();
            });
        }
        if (elements.searchInputLegacy) {
            elements.searchInputLegacy.addEventListener('input', (e) => {
                performSearch(e.target.value);
            });
        }
        if (elements.searchInput) {
            elements.searchInput.addEventListener("input", (e) => {
                if (elements.clearSearch) elements.clearSearch.classList.toggle('active', e.target.value.length > 0);
                showSearchSuggestions(e.target.value);
            });
        }
        if (elements.clearSearch) {
            elements.clearSearch.addEventListener("click", () => {
                if (elements.searchInput) elements.searchInput.value = '';
                if (elements.clearSearch) elements.clearSearch.classList.remove('active');
                if (elements.searchInput) elements.searchInput.focus();
                if (elements.searchResults) elements.searchResults.innerHTML = '';
            });
        }
        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeMenu();
                closeSearch();
                if (elements.userMenu) elements.userMenu.classList.remove('active');
                if (elements.logoutModal) elements.logoutModal.classList.remove('active');
                closeAuthModalFunc();
            }
        });
        // Initialize
        loadPersonalization();
        updateTime();
        setInterval(updateTime, 1000);
        setInterval(changePromoText, 5000);
        initScrollAnimations();
        updateSlider(); // Initial slider position
        updatePrice(); // Initial price
        updateCart(); // Initial cart
        updateUserUI(); // Initial user UI
        // Size Buttons
        document.querySelectorAll('.size-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                basePrice = parseInt(btn.dataset.price);
                updatePrice();
            });
        });
        // Categories Tabs
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => {
                    b.classList.remove('active');
                    b.setAttribute('aria-selected', 'false');
                });
                btn.classList.add('active');
                btn.setAttribute('aria-selected', 'true');
            });
        });
        // Auto open auth modal after 1 minute if not logged in
        setTimeout(() => {
            if (!authModalShown && !userData) {
                openAuthModalFunc();
            }
        }, 60000); // 1 minute
        // Mobile-specific optimizations
        function handleMobileOptimizations() {
            const isMobile = window.innerWidth <= 576;
          
            if (isMobile) {
                // Optimize product gallery for mobile
                const thumbnails = document.querySelector('.product-thumbnails');
                if (thumbnails) {
                    thumbnails.style.flexWrap = 'wrap';
                    thumbnails.style.justifyContent = 'center';
                }
              
                // Optimize cart items for mobile
                const cartItems = document.querySelectorAll('.cart-item');
                cartItems.forEach(item => {
                    item.style.flexDirection = 'row-reverse';
                    item.style.justifyContent = 'flex-end';
                    item.style.gap = '8px';
                });
              
                // Optimize recommendations for mobile
                const recGrid = document.querySelector('.rec-grid');
                if (recGrid) {
                    recGrid.style.gridTemplateColumns = '1fr';
                }
            }
        }
        // Call on load and resize
        handleMobileOptimizations();
        window.addEventListener('resize', handleMobileOptimizations);
        // Wizard Management
        let currentStep = 1;
        let subtotal = 880000; // Initial subtotal from products
        let discount = 0;
        let shipping = 30000;
        let tax = 80000;
        let packagingCost = 0;
        let paymentMethod = 'online';
        let packagingType = 'turquoise';
        let finalTotal = subtotal + shipping + tax - discount + packagingCost;
        function updateProgress() {
            const progress = ((currentStep - 1) / 3) * 100;
            elements.progressFill.style.width = `${progress}%`;
            elements.progressPercentage.textContent = `${Math.round(progress)}% تکمیل`;
            elements.steps.forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.toggle('active', stepNum === currentStep);
                step.classList.toggle('completed', stepNum < currentStep);
            });
        }
        function showStep(stepNum) {
            elements.stepContents.forEach(content => content.classList.remove('active'));
            document.getElementById(`wizardStep${stepNum}`).classList.add('active');
            currentStep = stepNum;
            updateProgress();
            if (stepNum === 4) {
                populateFinalSummary();
            }
        }
        function updateProductPrice(item) {
            const qty = parseInt(item.querySelector('.quantity').value);
            const unitPrice = parseInt(item.querySelector('.quantity').dataset.price);
            const totalPrice = qty * unitPrice;
            item.querySelector('.product-price').textContent = `${totalPrice.toLocaleString('fa-IR')} تومان`;
        }
        function updateSummary() {
            subtotal = 0;
            document.querySelectorAll('.product-item').forEach(item => {
                const qty = parseInt(item.querySelector('.quantity').value);
                const unitPrice = parseInt(item.querySelector('.quantity').dataset.price);
                subtotal += qty * unitPrice;
            });
            document.querySelectorAll('[data-type="subtotal"]').forEach(el => el.textContent = `${subtotal.toLocaleString('fa-IR')} تومان`);
            finalTotal = subtotal + shipping + tax - discount + packagingCost;
            document.querySelectorAll('[data-type="total"]').forEach(el => el.textContent = `${finalTotal.toLocaleString('fa-IR')} تومان`);
            elements.finalTotal.textContent = `${finalTotal.toLocaleString('fa-IR')} تومان`;
        }
        document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
            btn.addEventListener('click', () => {
                const item = btn.closest('.product-item');
                const input = item.querySelector('.quantity');
                input.value = parseInt(input.value) + 1;
                updateProductPrice(item);
                updateSummary();
            });
        });
        document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
            btn.addEventListener('click', () => {
                const item = btn.closest('.product-item');
                const input = item.querySelector('.quantity');
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                    updateProductPrice(item);
                    updateSummary();
                }
            });
        });
        // Remove button (optional, to handle removal)
        document.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const item = btn.closest('.product-item');
                item.remove();
                updateSummary();
            });
        });
        // Discount apply
        document.querySelector('.discount-btn').addEventListener('click', () => {
            const code = document.querySelector('.discount-input').value.trim();
            discount = code === 'DISCOUNT10' ? subtotal * 0.1 : 0; // Example discount
            document.querySelector('[data-type="discount"]').textContent = `${discount.toLocaleString('fa-IR')} تومان`;
            updateSummary();
        });
        // Packaging selection
        document.querySelectorAll('.packaging-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.packaging-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                packagingType = option.dataset.packaging;
                packagingCost = (packagingType === 'turquoise') ? 0 : 50000; // Example cost
                elements.packagingDisplay.textContent = `${option.querySelector('.packaging-name').textContent} (${packagingCost.toLocaleString('fa-IR')} تومان)`;
                document.getElementById('packaging-summary').textContent = `${option.querySelector('.packaging-name').textContent} (${packagingCost.toLocaleString('fa-IR')} تومان)`;
                updateSummary();
            });
        });
        // Payment selection
        document.querySelectorAll('.payment-option:not(.disabled)').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                paymentMethod = option.dataset.method;
                elements.paymentMethodDisplay.textContent = option.textContent.trim();
                if (paymentMethod === 'cod') {
                    document.getElementById('cod-upfront').style.display = 'flex';
                    document.getElementById('cod-remaining').style.display = 'flex';
                    document.getElementById('finalCodUpfront').style.display = 'flex';
                    document.getElementById('finalCodRemaining').style.display = 'flex';
                    const upfront = Math.round(finalTotal * 2 / 3);
                    const remaining = finalTotal - upfront;
                    document.querySelector('[data-type="cod-upfront"]').textContent = `${upfront.toLocaleString('fa-IR')} تومان`;
                    document.querySelector('[data-type="cod-remaining"]').textContent = `${remaining.toLocaleString('fa-IR')} تومان`;
                } else {
                    document.getElementById('cod-upfront').style.display = 'none';
                    document.getElementById('cod-remaining').style.display = 'none';
                    document.getElementById('finalCodUpfront').style.display = 'none';
                    document.getElementById('finalCodRemaining').style.display = 'none';
                }
            });
        });
        // Step 2 validation
        function validateStep2() {
            const firstName = elements.firstName.value.trim();
            const lastName = elements.lastName.value.trim();
            const city = elements.city.value;
            const address = elements.address.value.trim();
            const phone = elements.phone.value.trim();
            const deliveryTime = elements.deliveryTime.value.trim();
            const allFilled = firstName && lastName && city && address && phone && deliveryTime;
            // Phone validation (simple Iranian mobile)
            const phoneValid = /^09\d{9}$/.test(phone);
            // Delivery time validation (must be future)
            const selectedDate = new persianDate(elements.deliveryTime.value, 'YYYY/MM/DD HH:mm').toDate();
            const minDate = new Date(Date.now() + 24 * 60 * 60 * 1000);
            const timeValid = selectedDate > minDate;
            if (!timeValid) {
                elements.timeError.classList.add('active');
            } else {
                elements.timeError.classList.remove('active');
            }
            elements.nextToWizardStep3.disabled = !(allFilled && phoneValid && timeValid);
        }
        [elements.firstName, elements.lastName, elements.city, elements.address, elements.phone, elements.deliveryTime].forEach(field => {
            field.addEventListener('input', validateStep2);
            field.addEventListener('change', validateStep2);
        });
        // Initialize Persian Datepicker
        $(elements.deliveryTime).persianDatepicker({
            format: 'YYYY/MM/DD HH:mm',
            minDate: new Date().getTime() + 24 * 60 * 60 * 1000,
            timePicker: {
                enabled: true,
                meridiem: { enabled: false },
                hour: { enabled: true },
                minute: { enabled: true, step: 5 }
            },
            onSelect: validateStep2
        });
        // Populate final summary
        function populateFinalSummary() {
            elements.fullNameDisplay.textContent = `${elements.firstName.value} ${elements.lastName.value}`;
            elements.deliveryAddressDisplay.textContent = `${elements.province.value}، ${elements.city.value}، ${elements.address.value}`;
            elements.phoneDisplay.textContent = elements.phone.value;
            elements.deliveryTimeDisplay.textContent = elements.deliveryTime.value;
            elements.finalSubtotal.textContent = `${subtotal.toLocaleString('fa-IR')} تومان`;
            elements.finalDiscount.textContent = `${discount.toLocaleString('fa-IR')} تومان`;
            elements.finalShipping.textContent = `${shipping.toLocaleString('fa-IR')} تومان`;
            elements.finalTax.textContent = `${tax.toLocaleString('fa-IR')} تومان`;
            elements.packagingDisplay.textContent = document.getElementById('packaging-summary').textContent;
            // Products list
            const productsList = document.getElementById('finalProductsList');
            productsList.innerHTML = '';
            document.querySelectorAll('.product-item').forEach(item => {
                const name = item.querySelector('.product-name').textContent;
                const qty = item.querySelector('.quantity').value;
                const price = item.querySelector('.product-price').textContent;
                const summary = document.createElement('div');
                summary.className = 'product-summary';
                summary.innerHTML = `<span>${name} - تعداد: ${qty} - قیمت: ${price}</span>`;
                productsList.appendChild(summary);
            });
        }
        // Wizard navigation
        elements.nextToWizardStep2.addEventListener('click', (e) => {
            e.preventDefault();
            showStep(2);
        });
        elements.prevToWizardStep1.addEventListener('click', (e) => {
            e.preventDefault();
            showStep(1);
        });
        elements.nextToWizardStep3.addEventListener('click', (e) => {
            e.preventDefault();
            showStep(3);
        });
        elements.prevToWizardStep2.addEventListener('click', (e) => {
            e.preventDefault();
            showStep(2);
        });
        elements.nextToWizardStep4.addEventListener('click', (e) => {
            e.preventDefault();
            showStep(4);
        });
        elements.prevToWizardStep3.addEventListener('click', (e) => {
            e.preventDefault();
            showStep(3);
        });
        elements.confirmOrder.addEventListener('click', (e) => {
            e.preventDefault();
            confirmOrder();
        });
        // Initial updates
        document.querySelectorAll('.product-item').forEach(item => updateProductPrice(item));
        updateSummary();
        updateProgress();
        validateStep2();
        // Fetch cart items from backend
        const token = localStorage.getItem('access_token');
        if(token) {
            fetch('http://127.0.0.1:8000/api/cart/', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log("سبد خرید:", data);
                // اینجا سبد خرید رو تو صفحه نمایش بده
                const container = document.getElementById('cart-container');
                container.innerHTML = ''; // Clear existing static items
                data.forEach(item => {
                  const div = document.createElement('div');
                  div.className = 'product-item';
                  div.dataset.id = item.id; // Assuming item has an id
                  div.innerHTML = `
                    <img src="${item.product.image || 'https://placehold.co/80x80/26A69A/FFFFFF?text=' + item.product.name}" alt="${item.product.name}" class="product-image">
                    <div class="product-details">
                      <h3 class="product-name">${item.product.name}</h3>
                      <div class="product-meta">${item.product.description || ''}</div>
                      <div class="product-actions">
                        <div class="quantity-controls">
                          <button class="quantity-btn minus" aria-label="کاهش تعداد">-</button>
                          <input type="text" class="quantity" value="${item.quantity}" readonly aria-label="تعداد" data-price="${item.product.price}" data-id="${item.id}">
                          <button class="quantity-btn plus" aria-label="افزایش تعداد">+</button>
                        </div>
                        <div class="product-price" data-price="${item.product.price}" data-id="${item.id}">${(item.quantity * item.product.price).toLocaleString('fa-IR')} تومان</div>
                        <button class="remove-btn" aria-label="حذف محصول"><i class="fas fa-trash"></i></button>
                      </div>
                    </div>
                  `;
                  container.appendChild(div);
                });
                // Re-attach event listeners after dynamic load
                document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
                  btn.addEventListener('click', () => {
                    const item = btn.closest('.product-item');
                    const input = item.querySelector('.quantity');
                    input.value = parseInt(input.value) + 1;
                    updateProductPrice(item);
                    updateSummary();
                  });
                });
                document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
                  btn.addEventListener('click', () => {
                    const item = btn.closest('.product-item');
                    const input = item.querySelector('.quantity');
                    if (parseInt(input.value) > 1) {
                      input.value = parseInt(input.value) - 1;
                      updateProductPrice(item);
                      updateSummary();
                    }
                  });
                });
                document.querySelectorAll('.remove-btn').forEach(btn => {
                  btn.addEventListener('click', () => {
                    const item = btn.closest('.product-item');
                    item.remove();
                    updateSummary();
                  });
                });
                updateSummary();
            })
            .catch(error => {
                console.error('Error fetching cart:', error);
                // Optional: Show error message to user
            });
        } else {
            console.log("کاربر لاگین نیست، فرم ورود رو نشون بده");
            openAuthModalFunc(); // فرض بر اینه که این تابع فرم ورود رو باز می‌کنه
        }
    </script>
</body>
</html>